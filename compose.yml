services:
  document-uploader:
    image: ghcr.io/molecode/document-uploader:latest
    container_name: document-uploader
    restart: unless-stopped

    ports:
      - "5000:5000"

    environment:
      # Application settings
      - SECRET_KEY=${SECRET_KEY}
      - PASSWORD_HASH=${PASSWORD_HASH}

      # Upload configuration
      - UPLOAD_FOLDER=/paperless-consume
      - ALLOWED_EXTENSIONS=${ALLOWED_EXTENSIONS:-pdf,png,jpg,jpeg,gif,tiff,txt,doc,docx,odt,rtf}
      - MAX_FILE_SIZE=${MAX_FILE_SIZE:-52428800}

    volumes:
      # Mount the paperless-ngx consume directory
      - ${PAPERLESS_CONSUME_DIR}:/paperless-consume

    # Security settings
    security_opt:
      - no-new-privileges:true

    # Resource limits
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 512M
        reservations:
          memory: 128M

    # Health check
    healthcheck:
      test: ["CMD", "python", "-c", "import requests; requests.get('http://localhost:5000/health', timeout=5)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
